import os
from csv import writer
import nltk
import itertools
paths = '/media/chris/Elements/train'


def consolidate(path):
    s_path = path
    Files = os.listdir(s_path)
    byteFiles = [i for i in Files if '.bytes' in i]
    consolidatedFile = s_path + '_2gramfrequency.csv'
    hex_list = [hex(i)[2:].upper().zfill(2) for i in range(16**2)]
    two_gram = list(itertools.combinations(hex_list, 2))

    with open(consolidatedFile, 'w', newline='') as f:
        fw = writer(f)
        colnames = ['Id']
        colnames += ['2_' + str(i) for i in range(len(two_gram))]
        fw.writerow(colnames)
        for t, fname in enumerate(byteFiles):
            consolidation = []
            f = open(s_path + '/' + fname, 'rU')
            raw = f.read().split()
            raw2 = nltk.bigrams(raw)
            freq = nltk.FreqDist(raw2)
            hexByte = [0]*len(two_gram)
            for i in range(len(two_gram)):
                hexByte[i] = freq[two_gram[i]]
            consolidation += [fname[:fname.find('.bytes')]]
            consolidation += hexByte
            fw.writerow(consolidation)

if __name__ == '__main__':
    consolidate(paths)
    print("DONE 2-gram-bytes count!")
