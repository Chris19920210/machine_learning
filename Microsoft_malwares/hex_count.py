import os
from csv import writer
import nltk
paths = '/media/chris/Elements/train'


def consolidate(path):
    s_path = path
    Files = os.listdir(s_path)
    byteFiles = [i for i in Files if '.asm' in i]
    consolidatedFile = s_path + '_frequency2.csv'
    hex_list = [hex(i)[2:].upper().zfill(2) for i in range(16**2)]

    with open(consolidatedFile, 'w', newline='') as f:
        fw = writer(f)
        colnames = ['Id']
        colnames += ['A_' + hex(i)[2:].upper() for i in range(16**2)]
        fw.writerow(colnames)
        for t, fname in enumerate(byteFiles):
            consolidation = []
            f = open(s_path + '/' + fname, encoding="ISO-8859-1")
            raw = f.read().split()
            freq = nltk.FreqDist(raw)
            hexByte = [0]*16**2
            for i in range(len(hex_list)):
                hexByte[i] = freq[hex_list[i]]
            consolidation += [fname[:fname.find('.asm')]]
            consolidation += hexByte
            fw.writerow(consolidation)

if __name__ == '__main__':
    consolidate(paths)
    print("DONE bytes count!")
